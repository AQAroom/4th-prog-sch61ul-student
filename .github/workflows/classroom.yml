name: Autograding Tests
'on':
  - push
  - repository_dispatch
permissions:
  checks: write
  actions: read
  contents: read
jobs:
  # JOB 1
  run-autograding-tests:
    name: Оценка заданий
    runs-on: ubuntu-latest
    if: github.actor != 'github-classroom[bot]'
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
    
    # Тесты
    - name: Сложение
      id: add_test
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: Сложение
        command: python task.py
        input: |
          5
          +
          3
        expected-output: '8'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: Вычитание
      id: sub_test
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: Вычитание
        command: python task.py
        input: |
          10
          -
          4
        expected-output: '6'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: Умножение
      id: mul_test
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: Умножение
        command: python task.py
        input: |
          7
          *
          6
        expected-output: '42'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: Деление
      id: div_test
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: Деление
        command: python task.py
        input: |
          15
          /
          3
        expected-output: '5'
        comparison-method: contains
        timeout: 5
        max-score: 15
    
    - name: Степень
      id: pow_test
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: Степень
        command: python task.py
        input: |
          2
          ^
          3
        expected-output: '8'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: Деление на ноль
      id: div_zero_test
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: Деление на ноль
        command: python task.py
        input: |
          10
          /
          0
        expected-output: 'error'
        comparison-method: contains
        timeout: 5
        max-score: 15
    
    - name: Неизвестная операция
      id: unk_test
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: Неизвестная операция
        command: python task.py
        input: |
          5
          %
          3
        expected-output: 'Неизвестная операция'
        comparison-method: contains
        timeout: 5
        max-score: 10
    
    - name: Autograding Reporter
      id: reporter
      uses: classroom-resources/autograding-grading-reporter@v1
      env:
        ADD_RESULTS: "${{steps.add_test.outputs.result}}"
        SUB_RESULTS: "${{steps.sub_test.outputs.result}}"
        MUL_RESULTS: "${{steps.mul_test.outputs.result}}"
        DIV_RESULTS: "${{steps.div_test.outputs.result}}"
        POW_RESULTS: "${{steps.pow_test.outputs.result}}"
        DIV_ZERO_RESULTS: "${{ steps.div_zero_test.outputs.result }}"
        UNK_RESULTS: "${{steps.unk_test.outputs.result}}"
      with:
        runners: add_test,sub_test,mul_test,div_test,pow_test,div_zero_test,unk_test
